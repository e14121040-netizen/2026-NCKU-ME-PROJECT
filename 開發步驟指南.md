# 開發步驟指南 — 智慧倉儲物流機器人

> 本文件是整個專案的 **主開發流程指南**。  
> 按照以下 8 個階段逐步完成，每個階段都有明確的步驟和驗收標準。

---

## 階段 0：環境準備與採購

### 目標
確保所有軟體已安裝、零件已到貨。

### 步驟

1. **安裝開發環境**
   | 軟體 | 用途 | 下載連結 |
   |------|------|----------|
   | Arduino IDE 2.x | 取物機器人程式 | [arduino.cc](https://www.arduino.cc/en/software) |
   | App Inventor | 遙控 App | [appinventor.mit.edu](https://appinventor.mit.edu/) |
   | VS Code + EV3 MicroPython 擴充 | EV3 程式 | [pybricks.com](https://pybricks.com/ev3-micropython/) |
   | Python 3 + matplotlib | 連桿可視化 | `pip install matplotlib numpy` |
   | SolidWorks / Fusion 360 | 3D 建模 | 學校授權版 |

2. **安裝 Arduino 函式庫**
   在 Arduino IDE → 工具 → 管理函式庫，搜尋並安裝：
   - `Adafruit PWM Servo Driver Library`（PCA9685 驅動）
   - `Wire`（已內建）

3. **採購零件**
   參考 BOM 清單：
   - 取物機器人 → [`取物機器人(六足Chebyshev)/BOM.md`](取物機器人(六足Chebyshev)/BOM.md)
   - 運輸機器人 → [`運輸機器人(EV3)/BOM.md`](運輸機器人(EV3)/BOM.md)

4. **準備學長的參考資料**
   - `歷屆學長資料(2021屆)/` 中有學長的 `.aia`（App 原始檔）和 `.ino`（Arduino 程式）
   - 優先閱讀學長的 App 截圖，了解 UI 佈局

### ✅ 驗收標準
- [ ] 所有軟體安裝完成，Arduino IDE 能正常編譯空白程式
- [ ] BOM 上的零件都已到貨或確認供貨中
- [ ] 學長的 `.aia` 已下載並可在 App Inventor 中開啟

---

## 階段 1：取物機器人 — 底盤機構加工

### 目標
完成六足 Chebyshev 連桿底盤的實體加工與組裝。

### 前置條件
- 零件已到貨（壓克力板、M3 螺絲、軸承/墊圈）
- 已閱讀 [`Chebyshev連桿設計參考.md`](取物機器人(六足Chebyshev)/機構設計/Chebyshev連桿設計參考.md)

### 步驟

1. **用 Python 可視化工具確認連桿參數**
   ```bash
   cd 取物機器人\(六足Chebyshev\)/機構設計/
   python chebyshev_visualization.py
   ```
   - 按 `1` 看單足軌跡（確認步距 ≈ 80mm、步高 ≈ 60mm）
   - 按 `3` 比較不同參數
   - 確認最終參數：**曲柄 30mm / 連桿 75mm / 機架 75mm / 搖桿 75mm**

2. **SolidWorks 繪製連桿片 2D 圖**
   - 畫出曲柄、連桿、搖桿的 2D 輪廓
   - 標注所有孔位（M3 孔徑 3.2mm）
   - 匯出 DXF 供雷射切割

3. **繪製機身底盤**
   - 底盤長 ≈ 260mm、寬 ≈ 250mm
   - 預留馬達座孔位（2 顆直流馬達）
   - 預留手臂底座安裝孔

4. **雷射切割壓克力**
   - 連桿片：3mm 壓克力
   - 底盤：5mm 壓克力（或鋁板）
   - 每面各切 3 組（共 6 足 × 3 片 = 18 片連桿片）

5. **組裝六足底盤**
   - 用 M3 螺絲 + 尼龍墊圈當軸銷
   - 先裝一側 3 足，確認轉動順暢
   - 再裝另一側 3 足
   - 左右曲柄錯開 180°（三角步態）

6. **手搖測試**
   - 手動旋轉曲柄，觀察足端軌跡
   - 確認 6 足同步性良好、無卡死

### ✅ 驗收標準
- [ ] 6 足底盤已組裝完成，可手搖運動
- [ ] 足端軌跡接近直線段（著地段），確認 Chebyshev 機構正確
- [ ] 機體尺寸在 400×400mm 限制內

---

## 階段 2：取物機器人 — 電控接線與基礎測試

### 目標
完成所有電路接線，驗證馬達和藍芽基本功能。

### 前置條件
- 底盤機構已組裝完成（階段 1）
- Arduino MEGA、L298N、HC-05、電池等零件到貨

### 步驟

1. **依接線圖完成接線**
   - 參考 [`電控/接線圖.md`](取物機器人(六足Chebyshev)/電控/接線圖.md)
   - **先接 L298N + 直流馬達**（步行部分）
   - 暫時不裝 PCA9685 和伺服馬達

2. **上傳測試程式**
   - 先用精簡版測試程式驗證馬達方向：
   ```cpp
   // 在 Serial Monitor 輸入 f/b/l/r 測試
   void setup() {
     Serial.begin(9600);
     // ... Motor pin setup
   }
   void loop() {
     if (Serial.available()) {
       char c = Serial.read();
       // 控制馬達
     }
   }
   ```

3. **測試 HC-05 藍芽**
   - 手機安裝「Serial Bluetooth Terminal」App 測試連線
   - 確認鮑率 38400
   - 發送 `f` 確認馬達正轉

4. **上傳正式程式**
   - 上傳 `walking_robot.ino` 到 Arduino MEGA
   - 用手機藍芽 App 逐一測試所有步行指令：
     - `f` 前進、`b` 後退、`0` 停止
     - `l` 左轉、`r` 右轉
     - `q` 左旋、`e` 右旋

5. **接上 PCA9685 + 伺服馬達**
   - 接線參見接線圖 PCA9685 區塊
   - 測試手臂指令：`u/d`（肩）、`i/k`（肘）、`o/p`（爪）、`h`（歸位）

### ✅ 驗收標準
- [ ] 步行馬達前進/後退/轉向均正常
- [ ] 藍芽連線穩定，指令延遲 < 0.5 秒
- [ ] 伺服馬達回應正確，歸位角度正確
- [ ] 電池續航 > 15 分鐘

---

## 階段 3：取物機器人 — App Inventor 遙控 App

### 目標
完成手機遙控 App，可控制步行 + 手臂。

### 前置條件
- 藍芽通訊已成功測試（階段 2）

### 步驟

1. **方式 A：修改學長的 App（推薦）**
   - 匯入 `歷屆學長資料(2021屆)/底盤及吸氣馬達操作app.aia`
   - 對照 [`App指令對照表.md`](取物機器人(六足Chebyshev)/app_inventor/App指令對照表.md) 修改指令字元
   - 新增手臂控制按鈕區域

2. **方式 B：從零建立 App**
   - 參考 [`AppInventor開發指南.md`](取物機器人(六足Chebyshev)/app_inventor/AppInventor開發指南.md)
   - 依照 **橫式介面佈局** 設計

3. **測試 App**
   - 步行按鈕：**按住**發送指令、**放開**發送停止 `0`
   - 手臂按鈕：**單擊**發送指令
   - 測試慢速模式切換功能

4. **匯出 .apk 安裝到手機**
   - Build → App (provide QR code for .apk)
   - 安裝到操作員的 Android 手機

### ✅ 驗收標準
- [ ] App 可穩定連線 HC-05
- [ ] 所有步行按鈕正常（含慢速模式）
- [ ] 所有手臂按鈕正常
- [ ] 按鈕夠大，操作流暢

---

## 階段 4：取物機器人 — 手臂機構整合

### 目標
完成機械手臂的設計、組裝，並與底盤整合。

### 前置條件
- 底盤步行系統已完成（階段 1 + 2）
- App 遙控已完成（階段 3）

### 步驟

1. **設計手臂結構**
   - 2~3 軸手臂（肩 + 肘 + 夾爪）
   - 建議使用 MG996R 伺服（肩/肘）+ SG90（夾爪）
   - SolidWorks 建模，確認活動範圍

2. **加工手臂零件**
   - 3D 列印或壓克力切割
   - 組裝手臂，用手動測試活動範圍

3. **安裝到底盤**
   - 固定手臂底座到底盤前方
   - 確認手臂重心不會讓機器人翻倒

4. **調整伺服角度參數**
   - 修改 `walking_robot.ino` 中的角度設定：
     ```cpp
     const int SHOULDER_MIN = 30;   // 依實際組裝調整
     const int SHOULDER_MAX = 150;
     const int CLAW_OPEN = 40;      // 依夾爪間距調整
     const int CLAW_CLOSE = 110;
     ```
   - 反覆測試，直到夾取動作順暢

5. **完整功能測試**
   - App 操控步行 → 靠近目標 → 手臂抓取 → 放置
   - 確認步行和手臂可同時操作（不互相干擾）

### ✅ 驗收標準
- [ ] 手臂可從貨架高度夾取零件
- [ ] 夾爪夾持力足夠，零件不掉落
- [ ] 步行 + 手臂可同時操作
- [ ] 整機重心穩定，行走不翻倒

---

## 階段 5：運輸機器人 — EV3 組裝與程式

### 目標
完成 EV3 運輸機器人的組裝和程式調校。

### 前置條件
- EV3 套件已借到
- 已閱讀 [`運輸機器人(EV3)/README.md`](運輸機器人(EV3)/README.md)

### 步驟

1. **組裝 EV3 底盤**
   - 參考 [`EV3組裝設計參考.md`](運輸機器人(EV3)/機構設計/EV3組裝設計參考.md)
   - 安裝雙大馬達（Port B + C）
   - 安裝 3 顆顏色感測器（Port S1 + S2 + S3）

2. **組裝放置機構**
   - 用中馬達（Port A）驅動
   - 設計能將零件抬高到 100mm 放置區的機構

3. **部署程式**
   - 將 `transport_robot.py` 部署到 EV3
   - 使用 VS Code + EV3 MicroPython 擴充套件

4. **PID 循跡調校**
   - 在黑線軌道上測試
   - 調整 `transport_robot.py` 中的 PID 參數：
     ```python
     KP = 1.2       # 先從這組開始
     KI = 0.01
     KD = 0.5
     BASE_SPEED = 100
     ```
   - 調校步驟：
     1. 先只調 KP，讓車子能跟著線走（雖然會晃）
     2. 加入 KD，減少晃動
     3. 最後微調 KI，消除穩態誤差

5. **顏色偵測測試**
   - 在軌道上放黃色紙條 → 確認停車 + 執行放置動作
   - 放紅色紙條 → 確認停車等待

### ✅ 驗收標準
- [ ] EV3 可穩定循跡（不出軌）
- [ ] 正確辨識黃色/紅色停止線
- [ ] 放置機構能將零件抬到 100mm 高度
- [ ] 全程自動完成（不需人為介入）

---

## 階段 6：雙機聯合測試

### 目標
兩台機器人在模擬場地上協同完成任務。

### 前置條件
- 取物機器人完成（階段 1~4）
- 運輸機器人完成（階段 5）

### 步驟

1. **建立模擬場地**
   - 用黑色膠帶在場地鋪設軌跡線
   - 設置黃色放置區和紅色停止線
   - 準備模擬貨架和零件

2. **協同流程演練**
   ```
   取物機器人 app 遙控走到貨架
        → 夾取零件
        → 走到運輸機器人旁
        → 放置零件到運輸機器人
   運輸機器人 自動循跡
        → 行駛到放置區
        → 放置零件
        → 返回起點等待
   ```

3. **計時練習**
   - 記錄每次完整流程的時間
   - 找出瓶頸（通常是取物遙控操作時間）
   - 針對瓶頸優化

4. **故障排除**
   - 常見問題：
     - 藍芽斷線 → 檢查電池電壓、HC-05 天線
     - 循跡不穩 → 重新校正感測器、調 PID
     - 零件掉落 → 調整夾爪角度/力道

### ✅ 驗收標準
- [ ] 雙機聯合完成 1 次完整任務
- [ ] 完成時間 < 目標時間
- [ ] 操作流程清晰，操作員熟練

---

## 階段 7：報告、海報、最終調校

### 目標
完成所有書面資料，準備上台報告。

### 步驟

1. **撰寫報告**（存放在 `文件/報告/`）
   - 計畫書 / 期中報告 / 期末報告
   - 內容包含：動機、設計、實作過程、測試結果

2. **製作海報**（存放在 `文件/海報/`）
   - 海報尺寸依課程規定
   - 包含系統架構圖、實物照片、測試數據

3. **最終調校**
   - 確定比賽用的 PID 參數
   - 確定手臂角度參數
   - 全速度測試
   - 電池充滿

4. **準備備品**
   - 備用電池
   - 備用螺絲/墊圈
   - 備用伺服馬達
   - 工具箱（螺絲起子、鉗子等）

### ✅ 驗收標準
- [ ] 報告已繳交
- [ ] 海報已完成
- [ ] 備品齊全
- [ ] 全隊模擬演練至少 3 次

---

## 時間線建議

| 週次 | 階段 | 主要工作 |
|------|------|----------|
| 第 1~2 週 | 階段 0 | 環境準備、零件採購 |
| 第 3~4 週 | 階段 1 | 底盤機構加工組裝 |
| 第 5~6 週 | 階段 2 | 電控接線、基礎測試 |
| 第 7 週 | 階段 3 | App Inventor 開發 |
| 第 8~9 週 | 階段 4 | 手臂整合 |
| 第 7~9 週 | 階段 5 | EV3 (可與階段 3~4 並行) |
| 第 10~11 週 | 階段 6 | 聯合測試 |
| 第 12~14 週 | 階段 7 | 報告、海報、調校 |

> **提示**：階段 5（EV3）可以跟階段 3~4 **同時進行**，由不同組員負責。
