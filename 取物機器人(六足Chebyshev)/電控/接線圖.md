# 取物機器人 — 接線圖

> 本文件列出取物機器人所有電路接線。  
> Pin 腳編號與 `walking_robot.ino` 中的 `#define` 完全一致。

## 系統供電架構

```
11.1V 鋰電池 (3S LiPo)
    │
    ├──→ L298N 12V 輸入（步行馬達供電）
    │         └── L298N 5V 輸出可給 Arduino (不建議，電流不夠穩)
    │
    ├──→ LM2596 降壓模組
    │         └── 輸出 7~9V → Arduino MEGA Vin
    │
    └──→ PCA9685 V+ (伺服馬達供電)
              ⚠ 伺服馬達吃電大，建議另外供電或使用 BEC
```

> ⚠ **重要**：PCA9685 的 V+ 是伺服馬達專用電源，不要跟邏輯電源混用。

## Arduino MEGA ← → L298N（步行馬達）

```
Arduino MEGA              L298N
────────────              ─────
Pin 40 (Digital) ──→  IN1  ─┐
Pin 41 (Digital) ──→  IN2  ─┤── 馬達 A（左側 3 足）
Pin  9 (PWM)     ──→  ENA  ─┘

Pin 42 (Digital) ──→  IN3  ─┐
Pin 43 (Digital) ──→  IN4  ─┤── 馬達 B（右側 3 足）
Pin 10 (PWM)     ──→  ENB  ─┘

GND              ──→  GND   (共地)
```

| Arduino Pin | L298N Pin | 用途 | 程式碼定義 |
|-------------|-----------|------|------------|
| 40 | IN1 | 左馬達方向 1 | `MOTOR_L_IN1` |
| 41 | IN2 | 左馬達方向 2 | `MOTOR_L_IN2` |
| 9 | ENA | 左馬達 PWM 速度 | `MOTOR_L_EN` |
| 42 | IN3 | 右馬達方向 1 | `MOTOR_R_IN1` |
| 43 | IN4 | 右馬達方向 2 | `MOTOR_R_IN2` |
| 10 | ENB | 右馬達 PWM 速度 | `MOTOR_R_EN` |

> **注意**：L298N 板上的 ENA/ENB 跳線帽要拔掉，才能用 PWM 調速。

## Arduino MEGA ← → HC-05 藍芽

```
Arduino MEGA              HC-05
────────────              ─────
Pin 18 (TX1)   ──→  RXD
Pin 19 (RX1)   ←──  TXD
5V             ──→  VCC
GND            ──→  GND
```

| Arduino Pin | HC-05 Pin | 備註 |
|-------------|-----------|------|
| 18 (TX1) | RXD | MEGA 的 Serial1 TX |
| 19 (RX1) | TXD | MEGA 的 Serial1 RX |
| 5V | VCC | HC-05 供電 |
| GND | GND | 共地 |

> **注意**：程式碼使用 `Serial1.begin(38400)`，  
> HC-05 鮑率也要設成 **38400**（AT 指令：`AT+UART=38400,0,0`）。

> ⚠ HC-05 的 RXD 是 **3.3V 電平**，直接接 MEGA 的 5V TX 可能傷模組。  
> 建議加一個電阻分壓器（1kΩ + 2kΩ）做 5V → 3.3V 轉換。

## Arduino MEGA ← → PCA9685（伺服馬達）

```
Arduino MEGA              PCA9685
────────────              ───────
Pin 20 (SDA)   ←→  SDA    (I2C 資料)
Pin 21 (SCL)   ──→ SCL    (I2C 時脈)
5V             ──→ VCC    (邏輯電源)
GND            ──→ GND    (共地)

                          伺服電源
                   V+  ←── 外接 5~6V (BEC 或降壓模組)
                   GND ←── 外接電源 GND
```

### 伺服馬達通道分配

| PCA9685 通道 | 伺服馬達 | 角度範圍 | 歸位角度 | 程式碼定義 |
|-------------|---------|---------|---------|------------|
| CH 0 | 肩關節 (MG996R) | 30°~150° | 90° | `CH_SHOULDER` |
| CH 1 | 肘關節 (MG996R) | 30°~150° | 90° | `CH_ELBOW` |
| CH 2 | 夾爪 (SG90) | 40°~110° | 40° (開) | `CH_CLAW` |
| CH 3~5 | 預留 | — | — | 可擴充 |

### PCA9685 PWM 設定

```
SERVO_FREQ = 50 Hz     (標準伺服頻率)
SERVO_MIN  = 125       (0° 對應脈衝, out of 4096)
SERVO_MAX  = 575       (180° 對應脈衝)
```

## 完整接線總覽

```
                    ┌─────────────────┐
    HC-05 ←─Serial1─┤  Arduino MEGA   ├─ I2C ──→ PCA9685
    (藍芽)          │     2560        │           ├ CH0: 肩
                    │                 │           ├ CH1: 肘
   L298N ←──GPIO───┤  Pin 40~43      │           └ CH2: 爪
   (馬達)    PWM───┤  Pin 9, 10      │
                    │                 │
                    │  Vin ← 7~9V    │
                    │  GND ← 共地    │
                    └─────────────────┘

    11.1V 電池 ──→ L298N 12V (馬達電源)
                ──→ LM2596 ──→ 7~9V (Arduino Vin)
                ──→ BEC/降壓 ──→ 5~6V (PCA9685 V+ 伺服電源)
```

## 安全注意事項

1. **共地**：所有模組的 GND 都要連在一起
2. **勿反接**：馬達方向不對是正常的，改 IN1/IN2 接線即可，但電源絕對不能反接
3. **先測後裝**：先在桌上測試所有接線，確認正常後再裝上底盤
4. **電池保護**：鋰電池不要過放（低於 9.9V 就該充電），不用時拔掉電池接頭
5. **散熱**：L298N 會發熱，確保有散熱空間
