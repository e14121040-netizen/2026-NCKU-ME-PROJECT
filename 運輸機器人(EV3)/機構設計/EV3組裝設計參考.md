# EV3 運輸機器人 — 組裝設計參考

## 底盤結構

### 驅動方式
- **差速驅動**：左右各 1 顆大馬達，後方 1 顆萬向輪/球輪
- 輪距 (Axle Track) ≈ 120mm（程式中 `AXLE_TRACK = 120`）
- 輪徑 (Wheel Diameter) = 56mm（EV3 大輪，程式中 `WHEEL_DIAMETER = 56`）

### 建議佈局

```
        前方（行進方向 →）
    ┌──────────────────────┐
    │   [S3 前方顏色感測器] │
    │                      │
    │ [S1左]    EV3    [S2右]│  ← 顏色感測器朝下
    │          Brick       │
    │                      │
    │  ◎左輪          右輪◎ │  ← Port B, C
    │                      │
    │     ● 萬向輪         │
    │                      │
    │   [放置機構 Motor A]  │
    │   [觸碰感測器 S4]    │
    └──────────────────────┘
```

## 感測器安裝

### 循跡感測器（S1, S2）

- **位置**：底盤前方左右各一，距地面 ≈ 5~10mm
- **間距**：兩感測器間距 ≈ 20~30mm（略寬於黑線寬度）
- **朝向**：正下方朝地面
- **原理**：
  - 在黑線上 → 反射值低（~5~15）
  - 在白底上 → 反射值高（~50~70）
  - `error = left_val - right_val`
  - error > 0 → 偏左、error < 0 → 偏右

### 停止線感測器（S3）

- **位置**：底盤最前方，正下方朝地面
- **用途**：偵測黃色（放置區）/ 紅色（起點）停止線
- **使用 `color()` 方法**而非 `reflection()`

### 觸碰感測器（S4）

- **位置**：底盤後方或放置機構旁
- **用途**：啟動按鈕 + 偵測零件放置完成

## 放置機構設計

### 需求
- 將零件從底盤平面抬升到 **100mm 高度** 的放置區平台上

### 建議方案

#### 方案 A：槓桿推升式
```
靜止狀態：        放置狀態：
                   ┌─零件─┐
                   │      │  ← 100mm
   ┌─零件─┐       │      │
   │      │       │  ↑   │
───┴──────┴───   ──┴──┤──┴──
   [Motor A]        [Motor A 旋轉]
```
- 用中馬達旋轉一個 L 型臂
- 臂長需 ≥ 100mm
- 控制旋轉角度 90°（`PLACE_ANGLE = 90`）

#### 方案 B：齒輪升降台
```
   ┌──────┐
   │ 零件 │  ← 升降台
   └──┬───┘
      │ 齒輪齒條
   [Motor A]
```
- 用中馬達驅動齒輪，帶動齒條升降台
- 精度較高，但結構較複雜

### 建議
- 初期先用方案 A（簡單），能動再改進
- 確認 `PLACE_ANGLE` 和 `PLACE_SPEED` 參數與實際機構匹配

## 尺寸限制

- 機器人尺寸：長 ≤ 400mm、寬 ≤ 400mm
- EV3 底盤通常遠小於限制，問題不大

## 組裝順序

1. 先組底盤 + 兩大馬達 + 萬向輪
2. 安裝 EV3 Brick
3. 安裝循跡感測器 (S1, S2)，確認高度和間距
4. 安裝前方感測器 (S3)
5. 組裝放置機構 + 中馬達 (A)
6. 安裝觸碰感測器 (S4)
7. 連接所有線材
8. 部署程式，開始測試

## 常見問題

| 問題 | 解決方法 |
|------|----------|
| 循跡不穩、左右晃 | 調整 KP/KD、降低 BASE_SPEED |
| 顏色辨識失敗 | 確認感測器離地高度，周圍光線不要太強 |
| 放置機構力量不夠 | 加齒輪減速、減輕零件重量 |
| 馬達方向反了 | 修改 `Direction.CLOCKWISE` / `COUNTERCLOCKWISE` |
| EV3 連不上電腦 | 確認 microSD 卡已安裝 Pybricks、USB 線正常 |
